var _=(k,g,p)=>new Promise((w,c)=>{var i=o=>{try{f(p.next(o))}catch(u){c(u)}},b=o=>{try{f(p.throw(o))}catch(u){c(u)}},f=o=>o.done?w(o.value):Promise.resolve(o.value).then(i,b);f((p=p.apply(k,g)).next())});import{E as I,F as M}from"./index-DY4Ks39X.js";import{q as x,g as C,J as N,K as U,m as V,v as d,L as X,w as z,b as y}from"./element-plus-D9n4Ar5m.js";import{l as q,a as h,ah as A,m as E,p as K,q as n,O as t,R as s,V as m,u as a,W as L,S as T,P}from"./vue-chunks-DM5Q6aJS.js";const R=n("span",null,"导入步骤：",-1),j={style:{"margin-top":"7px"}},J=n("li",{style:{"margin-top":"7px"}},"编辑模板文件，（将需要导入的数据按格式填写进去）",-1),O=n("li",{style:{"margin-top":"7px"}},"上传模板文件，点击确认导入",-1),W=n("li",{style:{"margin-top":"7px"}},"查看导入结果，是否全部导入",-1),$={class:"mt-10px"},G={class:"flex justify-between mr-10px"},H=n("span",null,"导入结果",-1),Q={style:{color:"red"}},le=q({__name:"Import",emits:["getList"],setup(k,{emit:g}){const p=g,w=l=>{const e=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type),r=l.size/1024/1024<10;return e||y.error("上传文件必须是 XLSX 格式!"),r||y.error("上传文件大小不能超过 10MB!"),e&&r},c=h(),i=h([]),b=h([]),f=l=>_(this,null,function*(){i.value=[],i.value.push({filename:l.file.name,filesize:(l.file.size/1024).toFixed(1)+"KB",status:"上传成功"}),c.value=l.file}),o=()=>{i.value=[],c.value=null},u=h(!1),B=h(0),D=()=>_(this,null,function*(){u.value=!0;const l=new FormData;l.append("file",c.value);try{const e=yield I(l);e&&(b.value.push({filename:c.value.name,success_number:e.data.success_number,error_number:e.data.error_number,error_url:e.data.error_url}),B.value+=e.data.success_number,o(),p("getList"))}finally{u.value=!1}}),F=()=>_(this,null,function*(){y.info("正在下载请稍等！");const l=yield M();if(l){const e=document.createElement("a");e.style.display="none",e.href=l.data.url,e.target="_blank",e.download=l.data.filename;const r=new MouseEvent("click");e.dispatchEvent(r)}}),S=l=>_(this,null,function*(){y.info("正在下载请稍等！");const e=document.createElement("a");e.style.display="none",e.href=l.error_url,e.target="_blank",e.download=l.filename;const r=new MouseEvent("click");e.dispatchEvent(r)});return(l,e)=>{const r=A("BaseButton");return E(),K(P,null,[n("div",null,[R,n("ol",null,[n("li",j,[t(a(x),{onClick:F,target:"_blank",type:"primary"},{default:s(()=>[m(" 下载最新批量导入模板 ")]),_:1})]),J,O,W])]),n("div",null,[t(a(V),{gutter:10,class:"!mt-0 !mr-0"},{default:s(()=>[t(a(C),{span:1.5},{default:s(()=>[n("div",null,[t(a(N),{action:"","http-request":f,data:{path:"users"},"show-file-list":!1,"before-upload":w,accept:".xlsx",disabled:i.value.length>0},{default:s(()=>[t(a(U),{effect:"dark",content:"只支持上传XLSX文件",placement:"top"},{default:s(()=>[t(r,{type:"primary",size:"small",disabled:i.value.length>0},{default:s(()=>[m("上传文件")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["disabled"])])]),_:1}),t(a(C),{span:1.5},{default:s(()=>[t(r,{type:"primary",size:"small",disabled:i.value.length===0,loading:u.value,onClick:D},{default:s(()=>[m("确认导入")]),_:1},8,["disabled","loading"])]),_:1})]),_:1}),t(a(z),{data:i.value,border:!0,style:{width:"100%"},class:"mt-10px"},{default:s(()=>[t(a(d),{prop:"filename",label:"文件名称",align:"left"}),t(a(d),{prop:"filesize",label:"文件大小",width:"100",align:"center"}),t(a(d),{prop:"status",label:"上传状态",width:"100",align:"center"}),t(a(d),{fixed:"right",label:"操作",width:"130",align:"center"},{default:s(()=>[t(a(X),{title:"确认删除吗?",onConfirm:o},{reference:s(()=>[t(r,{link:"",type:"primary",size:"small"},{default:s(()=>[m("删除")]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),n("div",$,[n("div",G,[H,n("span",null,"成功导入总数："+L(B.value),1)]),t(a(z),{data:b.value,border:!0,style:{width:"100%"},class:"mt-10px"},{default:s(()=>[t(a(d),{prop:"filename",label:"文件名称",align:"left"}),t(a(d),{prop:"success_number",label:"成功数量",width:"100",align:"center"}),t(a(d),{prop:"error_number",label:"失败数量",width:"100",align:"center"},{default:s(v=>[n("span",Q,L(v.row.error_number),1)]),_:1}),t(a(d),{fixed:"right",label:"操作",width:"130",align:"center"},{default:s(v=>[v.row.error_number>0?(E(),T(a(x),{key:0,onClick:Y=>S(v.row),target:"_blank",type:"primary"},{default:s(()=>[m("下载失败数据")]),_:2},1032,["onClick"])):(E(),T(a(x),{key:1,type:"success",underline:!1},{default:s(()=>[m("成功全部导入")]),_:1}))]),_:1})]),_:1},8,["data"])])],64)}}});export{le as _};
//# sourceMappingURL=Import.vue_vue_type_script_setup_true_lang-BaMvI0Pw.js.map
